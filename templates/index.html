{% extends "main.html" %}
{% block main %}
{% with messages = get_flashed_messages() %}
{% if messages %}
<ul class=flashes>
  {% for message in messages %}
  <li>{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}
{% endwith %}
<ul id="products">
  {% for item in products %}
  <li>
    <h2>{{ item.name }}</h2>
    {% if item.description %}
    {{ item.description }}
    {% endif %}
    {% if item.images[0] %}
    <img src="{{ item.images[0] }}" alt="{{ item.name }}">
    {% endif %}
    {% if item.price['recurring'] %}
    <p>${{item.price['unit_amount'] // 100}} per {{item.price['recurring']['interval']}}</p>
    <button class=transaction id="{{item.price['id']}}" data-recurring=true
      data-loggedin="{{user.stripe_customer_id}}">Subscribe</button>
    {% else %}
    <p>${{item.price['unit_amount'] // 100}}</p>
    <button class=transaction id="{{item.price['id']}}" data-recurring=false
      data-loggedin="{{user.stripe_customer_id}}">Purchase</button>
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% endblock %}
